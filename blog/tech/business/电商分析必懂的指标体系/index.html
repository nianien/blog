<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/e4af272ccee01ff0-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/0a7d53676a1eb136.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-42d55485b4428e47.js"/><script src="/_next/static/chunks/4bd1b696-8ec333fca6b38e39.js" async=""></script><script src="/_next/static/chunks/1684-a2aac8a674e5d38c.js" async=""></script><script src="/_next/static/chunks/main-app-2791dc86ed05573e.js" async=""></script><script src="/_next/static/chunks/6874-7791217feaf05c17.js" async=""></script><script src="/_next/static/chunks/app/layout-51baccc14cf1da9e.js" async=""></script><script src="/_next/static/chunks/968-d7155a2506e36f1d.js" async=""></script><script src="/_next/static/chunks/app/blog/%5B...slug%5D/page-1a068657a275b968.js" async=""></script><meta name="next-size-adjust" content=""/><title>电商分析必懂的指标体系 - Skyfalling Blog</title><meta name="description" content="今天，我就来讲讲电商到底该重点关注哪些指标，又该拿这些指标来进行怎么样的分析。 一般来说，在运营模块，需要重点关注的是新用户的引流和转化，以及老用户的活跃、留存、回购、流失。 简单来说，引流就是要吸引没买过我们的商品的人来买我们的商品。..."/><meta property="og:title" content="电商分析必懂的指标体系"/><meta property="og:description" content="今天，我就来讲讲电商到底该重点关注哪些指标，又该拿这些指标来进行怎么样的分析。 一般来说，在运营模块，需要重点关注的是新用户的引流和转化，以及老用户的活跃、留存、回购、流失。 简单来说，引流就是要吸引没买过我们的商品的人来买我们的商品。..."/><meta property="og:type" content="article"/><meta property="article:published_time" content="2024-03-10"/><meta property="article:author" content="Skyfalling"/><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="电商分析必懂的指标体系"/><meta name="twitter:description" content="今天，我就来讲讲电商到底该重点关注哪些指标，又该拿这些指标来进行怎么样的分析。 一般来说，在运营模块，需要重点关注的是新用户的引流和转化，以及老用户的活跃、留存、回购、流失。 简单来说，引流就是要吸引没买过我们的商品的人来买我们的商品。..."/><link rel="shortcut icon" href="/favicon.png"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="16x16"/><link rel="icon" href="/favicon.png"/><link rel="apple-touch-icon" href="/favicon.png"/><script>document.querySelectorAll('body link[rel="icon"], body link[rel="apple-touch-icon"]').forEach(el => document.head.appendChild(el))</script><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="__className_f367f3"><div hidden=""><!--$--><!--/$--></div><div class="min-h-screen flex flex-col"><header class="bg-[var(--background)]"><nav class="mx-auto flex max-w-7xl items-center justify-between p-6 lg:px-8" aria-label="Global"><div class="flex lg:flex-1"><a class="-m-1.5 p-1.5" href="/"><span class="sr-only">Skyfalling Blog</span><span class="text-2xl font-bold text-gray-900">Skyfalling</span></a></div><div class="flex lg:hidden"><button type="button" class="-m-2.5 inline-flex items-center justify-center rounded-md p-2.5 text-gray-700"><span class="sr-only">打开主菜单</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="h-6 w-6"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path></svg></button></div><div class="hidden lg:flex lg:gap-x-12"><a class="text-base font-semibold leading-6 transition-colors text-gray-900 hover:text-blue-600" href="/">首页</a><a class="text-base font-semibold leading-6 transition-colors text-blue-600 border-b-2 border-blue-600 pb-1" href="/blog/">博客</a><a class="text-base font-semibold leading-6 transition-colors text-gray-900 hover:text-blue-600" href="/about/">关于</a></div><div class="hidden lg:flex lg:flex-1 lg:justify-end"><a class="text-base font-semibold leading-6 transition-colors text-gray-900 hover:text-blue-600" href="/contact/">联系 <span aria-hidden="true">→</span></a></div></nav></header><main class="flex-1"><article class="min-h-screen"><div class="mx-auto max-w-6xl px-4 sm:px-6 lg:px-8 py-8"><div class="rounded-2xl shadow-2xl border border-gray-200 hover:shadow-3xl transition-all duration-300 p-8 sm:p-12"><header class="mb-8"><div class="flex items-center mb-6"><div class="inline-flex items-center px-3 py-1.5 bg-gray-50 text-gray-600 rounded-md text-sm font-normal"><svg class="w-4 h-4 mr-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg><time dateTime="2024-03-10">2024年03月10日</time></div></div><h1 class="text-4xl font-bold text-gray-900 mb-6 text-center">电商分析必懂的指标体系</h1><div class="flex flex-wrap gap-2 mb-6 justify-center"><a class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-gray-200 text-gray-800 hover:bg-gray-300 hover:text-gray-900 transition-colors" href="/blog/tag/%E4%B8%9A%E5%8A%A1%E6%9E%B6%E6%9E%84/page/1/">业务架构</a><a class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-gray-200 text-gray-800 hover:bg-gray-300 hover:text-gray-900 transition-colors" href="/blog/tag/%E7%94%B5%E5%95%86%E5%88%86%E6%9E%90/page/1/">电商分析</a></div></header><div class="max-w-5xl mx-auto"><div class="prose prose-lg prose-gray mx-auto max-w-none prose-headings:text-gray-900 prose-headings:font-bold prose-p:text-gray-700 prose-p:leading-relaxed prose-a:text-blue-600 prose-a:no-underline hover:prose-a:text-blue-700 prose-strong:text-gray-900 prose-strong:font-semibold prose-blockquote:border-l-4 prose-blockquote:border-blue-500 prose-blockquote:bg-blue-50 prose-blockquote:py-2 prose-blockquote:px-4 prose-blockquote:rounded-r-lg prose-ul:list-disc prose-ol:list-decimal prose-li:text-gray-700 prose-hr:border-gray-300"><p><a href="https://baijiahao.baidu.com/s?id=1767197729364093558">转载</a></p>
<p>今天，我就来讲讲电商到底该重点关注哪些指标，又该拿这些指标来进行怎么样的分析。</p>
<p>一般来说，在运营模块，需要重点关注的是新用户的引流和转化，以及老用户的活跃、留存、回购、流失。</p>
<p><img src="/images/blog/tech/business/image_2_1.png" alt="image_2_1.png"></p>
<h2>01 引流</h2>
<p>简单来说，引流就是要吸引没买过我们的商品的人来买我们的商品。</p>
<h2>1. 用户浏览量周分布</h2>
<p>分析这个指标，主要是为了摸索出不同日期、不同时段的流量规律，并据此对企业服务及推广活动进行调整。</p>
<p>对于互联网企业来说，流量数据往往都会呈工作周相关。对此，我们可以先宏观地统计出周一到周日中的总的平台流量柱状图数据对比情况。首先我们可以仔细观察工作日和非工作日的数据，发现周末的平台流量较工作日流量要高，这在互联网行业来说都是一个比较普遍的现象。</p>
<p><img src="/images/blog/tech/business/image_2_2.png" alt="image_2_2.png"></p>
<p>掌握了用户流量的周分布规律之后，我们就大致有一个推广方向，周末休息时间用户群体较大，相较于工作日可以投入更多的和丰富有吸引力推广活动来进行新用户引流和老用户活跃。</p>
<p>接着我们可以进行下一步思考，那工作日和周末我们的活动推广时间如何制定？</p>
<p>有的同学们可能会觉得全天活动都可以，不需要关注具体的活动时间。但是对于互联网行业来说，每个时间段的推广费用都是较为昂贵的，我们完全可以分析出工作日和周末的用户流量趋势，进行有针对性的时间段投入推广，通过更小的成本获取到更多的用户流入。</p>
<p>首先是工作日的时间段流量统计分布，我们通过FineBI工具分时间段作图得到如下所示的流量分布图。可以看出，工作日的流量主要集成在每日的9点（上班时间）、13点（午餐时间）、20点（晚间娱乐休息时间），那么在得到这样的一些用户流量规律之后，便可以在这些用户活跃高峰期时间段有针对性对白领群体多做一些相关商品推广活动，以实现最小时间成本和推广费用最大化用户引流效果。</p>
<p><img src="/images/blog/tech/business/image_2_3.png" alt="image_2_3.png"></p>
<p>再来看周末的各时间段流量分布走势，和工作日所不同的是，周末的流量早高峰期延后到了10点，这可能和各位小伙伴们周日作息较晚有关（同学们周末都是几点起床呢），除此之外，晚上的流量高峰退潮期也有延后。针对与周末用户流量分布的特性，互联网企业在周末时可以将活动开始时间和活动结束时间都适当进行延后，这个时候不能再套用工作日制定好的活动时间计划了，因为符合用户群体作息规律的推广促销活动才能达到更好的效果。</p>
<h2>2. 推广渠道流量分布</h2>
<p>电商推广渠道主要有三种：线上渠道（谷歌、百度等），线下渠道（活动、会议等），新媒体营销（微信、小红书等）。</p>
<p>通过对不同推广渠道的流量进行分析，我们可以清晰看出各个渠道对企业带来的价值占比差异，便于制定有针对性的营销策略。<br><img src="/images/blog/tech/business/image_2_4.png" alt="image_2_4.png"></p>
<p>如上图所示，由于推广渠道是分多层级的，我们通过FineBI工具的多层饼图进行数据的分析统计再合适不过了。分析下图的数据我们可以看出，首先是一级渠道的主要战斗力来自于新媒体营销，当今的微信、知乎等社交媒介社区时代受众广泛，用户群体非常庞大，是公司需要投入主要成本进行推广的。其次线上渠道的效果也不容忽视，对于互联网企业来说，做好百度、Google等SEO搜索引擎关键词推广也是很重要的一部分工作。相较于线上渠道和新媒体营销，线下渠道说所需要的经费和时间、人力成本较大，受众又相对较小，所以此类活动往往针对核心粉丝进行运营即可。</p>
<p><img src="/images/blog/tech/business/image_2_5.png" alt="image_2_5.png"></p>
<h2>3. 访问深度用户群体分布</h2>
<p>这里涉及到跳失率的概念，即顾客通过相应入口进入，只访问了一个页面就离开的访问次数占该页面总访问次数的比例。跳失率=跳出次数/访问次数。跳失率越低，用户的访问越有深度。</p>
<p><img src="/images/blog/tech/business/image_2_6.png" alt="image_2_6.png"></p>
<p>如上图所示，我们通过BI工具将企业的VIP用户、老用户、新用户分别进行分时间段的用户群体访问深度分析统计。总体来说可以发现平台的VIP用户访问深度较老用户以及新用户稍微高些，但是不是太明显，说明平台运营的VIP这部分群体的活跃度还有待提升。</p>
<p>同时，平台老用户访问深度和新用户更是相差无几，公司对于用户这方面的活跃运营明显需要加油了，建议将平台的部分忠诚度较高的老用户以VIP用户组建起来，共建平台生态圈，增加整体的用户活跃度。也可以向老用户以及VIP用户实施一些优惠政策，如定向商品折扣、根据用户画像进行喜好商品特惠推送等。</p>
<h2>4. 核心指标对比走势</h2>
<p>主要强调的是核心指标的动态变化。那什么是这里所提及的“核心指标”呢？</p>
<p>不管是电商还是其他互联网行业，往往都需要关注如下指标：</p>
<ul>
<li>浏览量-PV;</li>
<li>访问次数-Visits；</li>
<li>访客数-UV；</li>
<li>平均访问深度（总浏览量/访问次数），</li>
<li>平均停留时间（总停留时间/总浏览量），</li>
<li>跳失率（跳出次数/访问次数）。</li>
</ul>
<p>其中，前面三个指标常常用来衡量流量数据的数量，后面三个指标则多用衡量流量指标的质量。通过对这些指标的动态分析，我们可以很好地评估某一时段推出的营销策略的效果。</p>
<p><img src="/images/blog/tech/business/image_2_7.png" alt="image_2_7.png"></p>
<p>举个例子，我们仔细分析上图中的平台流量指标，可以发现10月份是2017全年的流量高峰期，应该跟企业在国庆黄金假期所做的促销引流活动有关。浏览量、跳失次数、访问次数分别为4941、1290、2182，对比计算可得到跳失率为59.12%，明显低于其他时间段的跳失率，说明10月份的活动效果还不错，其经验对以后的营销推广可以起到参考作用。</p>
<h2>02 转化</h2>
<p>在通过引流吸引到了新用户的目光之后，往往需要采取一系列的运营策略，实现用户的转化，也就是让用户搜索商品-浏览商品-下单商品-交易付款。在转化阶段，需要重点关注的指标有：下单转化率、事件转化率、服务转化率和退货率。</p>
<h2>1. 下单转化率</h2>
<p>对于平台经营方来说，我们希望一旦有用户流量进入平台网站，他们就能够顺利按照我们平台运营设定好的系列要求一步步进行下去，最终完成交易付款操作。那么对于互联网运营方来说，就需要做好用户在会员注册、商品收藏、购物车添加、交易付款等环节的转化操作。对于这样需要进行逐级转化的平台运营，我们首先可以通过漏斗图进行宏观的流程转化数据分析找出目前阶段最需要优化的运营环节，有效地进行针对性治理，最终提高整体平台用户下单转化率。</p>
<p><img src="/images/blog/tech/business/image_2_8.png" alt="image_2_8.png"></p>
<p>以上面这个漏斗呈现的信息为例：</p>
<p>首先看用户从浏览商品行为到添加购物车行为这一流程的转化情况，通过漏斗图可以快速看出其转化率为50.77%，反映出该平台的商品介绍、图片描述等对用户有较强的吸引力。</p>
<p>接下来继续看添加购物车到下单的转化率，可以看出其转化率高达99.66%，非常不错。之后却看到单至付款的转化率仅50%，这是一个值得反思的转化节点，通过数据分析猜测该平台商铺支付渠道不完善，需要增加例如支付宝、微信等快捷支付渠道，降低平台因为没有提供用户习惯性的支付渠道而导致用户放弃购买行为的几率。</p>
<h2>2、事件转化率</h2>
<p>事件转化率通常指的是平台或商铺通过一系列的运营推广活动以及由于公共事件影响所带来的额外价值。这一指标对于平台运营评估和指导市场推广运营活动极为重要，例如网络营销总的SEO关键词投放、折扣促销活动、邮件营销等等效果跟踪。关于事件转化率方面的数据分析，通常我们可关注于营销渠道转化率、会员转化率、店铺流量转化率、下单转化率等指标进行活动的推广营销效果评估。</p>
<p>利用BI工具，首先分析出各个营销推广渠道的转化率环形玫瑰分布图。可以看出目前平台的转化率最高的渠道主要是基础上线工作、SEO关键词推广、微信推广、品牌推广几个渠道。同时我们想联动查看每个渠道对应的转化率数据时，通过BI工具提供的数据自动联动过滤功能让用户无需任何设置即可进行所有相关联的数据联动。</p>
<p><img src="/images/blog/tech/business/image_2_9.png" alt="image_2_9.png"></p>
<p>除了以上渠道营销策略之外，对于平台商铺而言，合适的关联性商品推荐也能够提高用户对关联商品的购买率，比如用户在购买完服装之后可以再给他推送鞋子一类商品。另外关于事件转化率方面，由于季节性以及公共事件也会影响商品的下单转化率，针对不同时期较流行的商品进行进货营销往往才能够达到最大的盈利目的。</p>
<p><img src="/images/blog/tech/business/image_2_10.png" alt="image_2_10.png"></p>
<h2>3、服务转化率</h2>
<p>服务转化率方面，通常用户在网上购买商品时，对于商品的一些细节品质以及发货渠道和速度等会需要做一些了解。那么良好的服务自然能够提高顾客的购买率，对于平台的客户人员，我们可以统计处其咨询到下单的节点转化率，并且以咨询到下单的转换率指标作为KPI指标之一来评价客服人员的工作绩效。</p>
<p>如下图所示，通过BI工具进行客服咨询下单转化率条形图的数据分析统计可以发现，该平台的Blanche、Henry、Christian、汉克、贝蒂这五名客服的转化率比较优秀，并且都在10%以上，其他的客服员工的转化率则相对较低，故而这方面可以让转化率最为优秀的Blanche客服给其他客服做一次服务培训，整体上提升平台的服务水平，进而提升用户的下单转化率。</p>
<p><img src="/images/blog/tech/business/image_2_11.png" alt="image_2_11.png"></p>
<h2>4、退货率</h2>
<p>对于用户而言退货的原因通常可分为两大类，一类是由于买到的商品质量有问题而申请退货，另外一类可能是由于用户自身原因想申请退货。平台方往往更为需要关注第一类因为商品质量问题而申请退货的商品，通过历史商品的质量原因退货数据统计分析，对于确确实实是存在质量问题的商品需要及时反馈给供应商，质量过于严重的话可以考虑该类商品和供应商的协商库存退货。</p>
<h2>03 留存</h2>
<p>新用户转化成功，变成老用户之后，我们需要着重关注留存问题，简而言之就是关注怎么做才能留住客户的心。</p>
<p>我们可以从宏观上来定义平台的留存用户：在互联网行业中，用户在某段时间内开始使用应用，经过一段时间后，仍然继续使用该应用的用户，被认作是留存用户。我们往往希望留存用户越多越好。</p>
<p>一般来说，留存方面，需要关注如下指标：</p>
<h2>1. 次日/7日/30日留存</h2>
<p>即某天新增的用户中，在次日/7天后/30天后依然”活跃“（比如有浏览行为、收藏行为、购买行为等）的比例。</p>
<p>不同时长的留存率分析可以折射出不同的问题。一般而言，分析次日留存率有利于抓住产品的品质变动和渠道优势；7日留存率可以体现出一个较为完整的周期后的用户去留情况；30日留存率可以反应产品或渠道迭代后的稳定性，协助判断演进方向的合理性。</p>
<p><img src="/images/blog/tech/business/image_2_12.png" alt="image_2_12.png"></p>
<h2>2. 渠道留存</h2>
<p>不同渠道的用户质量往往是不尽相同的。再考虑留存率的同时，对比留存渠道，可以进行更高质量的广告投放。</p>
<p><img src="/images/blog/tech/business/image_2_13.png" alt="image_2_13.png"></p>
</div></div><!--$!--><template data-dgst="BAILOUT_TO_CLIENT_SIDE_RENDERING"></template><div class="mt-12 pt-8 border-t border-gray-200">加载导航中...</div><!--/$--><div class="mt-16 border-t border-gray-200 pt-8"><div class="mx-auto max-w-3xl"><h3 class="text-2xl font-bold text-gray-900 mb-8">评论</h3></div></div></div></div></article><!--$--><!--/$--></main><footer class="bg-[var(--background)]"><div class="mx-auto max-w-7xl px-6 py-12 md:flex md:items-center md:justify-between lg:px-8"><div class="flex justify-center space-x-6 md:order-2"><a class="text-gray-600 hover:text-gray-800" href="/about/">关于</a><a class="text-gray-600 hover:text-gray-800" href="/blog/">博客</a><a class="text-gray-600 hover:text-gray-800" href="/contact/">联系</a></div><div class="mt-8 md:order-1 md:mt-0"><p class="text-center text-xs leading-5 text-gray-600">© 2024 Skyfalling Blog. All rights reserved.</p></div></div></footer></div><script src="/_next/static/chunks/webpack-42d55485b4428e47.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[10616,[\"6874\",\"static/chunks/6874-7791217feaf05c17.js\",\"7177\",\"static/chunks/app/layout-51baccc14cf1da9e.js\"],\"default\"]\n3:I[87555,[],\"\"]\n4:I[31295,[],\"\"]\n5:I[6874,[\"6874\",\"static/chunks/6874-7791217feaf05c17.js\",\"968\",\"static/chunks/968-d7155a2506e36f1d.js\",\"6909\",\"static/chunks/app/blog/%5B...slug%5D/page-1a068657a275b968.js\"],\"\"]\n7:I[59665,[],\"OutletBoundary\"]\na:I[74911,[],\"AsyncMetadataOutlet\"]\nc:I[59665,[],\"ViewportBoundary\"]\ne:I[59665,[],\"MetadataBoundary\"]\n10:I[26614,[],\"\"]\n:HL[\"/_next/static/media/e4af272ccee01ff0-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/css/0a7d53676a1eb136.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"B__hhCIN0XnpLTOdqGevC\",\"p\":\"\",\"c\":[\"\",\"blog\",\"tech\",\"business\",\"%E7%94%B5%E5%95%86%E5%88%86%E6%9E%90%E5%BF%85%E6%87%82%E7%9A%84%E6%8C%87%E6%A0%87%E4%BD%93%E7%B3%BB\",\"\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"tech/business/%E7%94%B5%E5%95%86%E5%88%86%E6%9E%90%E5%BF%85%E6%87%82%E7%9A%84%E6%8C%87%E6%A0%87%E4%BD%93%E7%B3%BB\",\"c\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/0a7d53676a1eb136.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"zh-CN\",\"children\":[\"$\",\"body\",null,{\"className\":\"__className_f367f3\",\"children\":[\"$\",\"div\",null,{\"className\":\"min-h-screen flex flex-col\",\"children\":[[\"$\",\"$L2\",null,{}],[\"$\",\"main\",null,{\"className\":\"flex-1\",\"children\":[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}],[\"$\",\"footer\",null,{\"className\":\"bg-[var(--background)]\",\"children\":[\"$\",\"div\",null,{\"className\":\"mx-auto max-w-7xl px-6 py-12 md:flex md:items-center md:justify-between lg:px-8\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex justify-center space-x-6 md:order-2\",\"children\":[[\"$\",\"$L5\",null,{\"href\":\"/about\",\"className\":\"text-gray-600 hover:text-gray-800\",\"children\":\"关于\"}],[\"$\",\"$L5\",null,{\"href\":\"/blog\",\"className\":\"text-gray-600 hover:text-gray-800\",\"children\":\"博客\"}],[\"$\",\"$L5\",null,{\"href\":\"/contact\",\"className\":\"text-gray-600 hover:text-gray-800\",\"children\":\"联系\"}]]}],[\"$\",\"div\",null,{\"className\":\"mt-8 md:order-1 md:mt-0\",\"children\":[\"$\",\"p\",null,{\"className\":\"text-center text-xs leading-5 text-gray-600\",\"children\":\"© 2024 Skyfalling Blog. All rights reserved.\"}]}]]}]}]]}]}]}]]}],{\"children\":[\"blog\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"slug\",\"tech/business/%E7%94%B5%E5%95%86%E5%88%86%E6%9E%90%E5%BF%85%E6%87%82%E7%9A%84%E6%8C%87%E6%A0%87%E4%BD%93%E7%B3%BB\",\"c\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L6\",null,[\"$\",\"$L7\",null,{\"children\":[\"$L8\",\"$L9\",[\"$\",\"$La\",null,{\"promise\":\"$@b\"}]]}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"pmLVyWDbhHsFAVAU4g32Gv\",{\"children\":[[\"$\",\"$Lc\",null,{\"children\":\"$Ld\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}],[\"$\",\"$Le\",null,{\"children\":\"$Lf\"}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$10\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"11:\"$Sreact.suspense\"\n12:I[74911,[],\"AsyncMetadata\"]\n14:I[32923,[\"6874\",\"static/chunks/6874-7791217feaf05c17.js\",\"968\",\"static/chunks/968-d7155a2506e36f1d.js\",\"6909\",\"static/chunks/app/blog/%5B...slug%5D/page-1a068657a275b968.js\"],\"default\"]\n16:I[40780,[\"6874\",\"static/chunks/6874-7791217feaf05c17.js\",\"968\",\"static/chunks/968-d7155a2506e36f1d.js\",\"6909\",\"static/chunks/app/blog/%5B...slug%5D/page-1a068657a275b968.js\"],\"default\"]\n19:I[85300,[\"6874\",\"static/chunks/6874-7791217feaf05c17.js\",\"968\",\"static/chunks/968-d7155a2506e36f1d.js\",\"6909\",\"static/chunks/app/blog/%5B...slug%5D/page-1a068657a275b968.js\"],\"default\"]\nf:[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$11\",null,{\"fallback\":null,\"children\":[\"$\",\"$L12\",null,{\"promise\":\"$@13\"}]}]}]\n15:T3376,"])</script><script>self.__next_f.push([1,"\u003cp\u003e\u003ca href=\"https://baijiahao.baidu.com/s?id=1767197729364093558\"\u003e转载\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e今天，我就来讲讲电商到底该重点关注哪些指标，又该拿这些指标来进行怎么样的分析。\u003c/p\u003e\n\u003cp\u003e一般来说，在运营模块，需要重点关注的是新用户的引流和转化，以及老用户的活跃、留存、回购、流失。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/blog/tech/business/image_2_1.png\" alt=\"image_2_1.png\"\u003e\u003c/p\u003e\n\u003ch2\u003e01 引流\u003c/h2\u003e\n\u003cp\u003e简单来说，引流就是要吸引没买过我们的商品的人来买我们的商品。\u003c/p\u003e\n\u003ch2\u003e1. 用户浏览量周分布\u003c/h2\u003e\n\u003cp\u003e分析这个指标，主要是为了摸索出不同日期、不同时段的流量规律，并据此对企业服务及推广活动进行调整。\u003c/p\u003e\n\u003cp\u003e对于互联网企业来说，流量数据往往都会呈工作周相关。对此，我们可以先宏观地统计出周一到周日中的总的平台流量柱状图数据对比情况。首先我们可以仔细观察工作日和非工作日的数据，发现周末的平台流量较工作日流量要高，这在互联网行业来说都是一个比较普遍的现象。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/blog/tech/business/image_2_2.png\" alt=\"image_2_2.png\"\u003e\u003c/p\u003e\n\u003cp\u003e掌握了用户流量的周分布规律之后，我们就大致有一个推广方向，周末休息时间用户群体较大，相较于工作日可以投入更多的和丰富有吸引力推广活动来进行新用户引流和老用户活跃。\u003c/p\u003e\n\u003cp\u003e接着我们可以进行下一步思考，那工作日和周末我们的活动推广时间如何制定？\u003c/p\u003e\n\u003cp\u003e有的同学们可能会觉得全天活动都可以，不需要关注具体的活动时间。但是对于互联网行业来说，每个时间段的推广费用都是较为昂贵的，我们完全可以分析出工作日和周末的用户流量趋势，进行有针对性的时间段投入推广，通过更小的成本获取到更多的用户流入。\u003c/p\u003e\n\u003cp\u003e首先是工作日的时间段流量统计分布，我们通过FineBI工具分时间段作图得到如下所示的流量分布图。可以看出，工作日的流量主要集成在每日的9点（上班时间）、13点（午餐时间）、20点（晚间娱乐休息时间），那么在得到这样的一些用户流量规律之后，便可以在这些用户活跃高峰期时间段有针对性对白领群体多做一些相关商品推广活动，以实现最小时间成本和推广费用最大化用户引流效果。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/blog/tech/business/image_2_3.png\" alt=\"image_2_3.png\"\u003e\u003c/p\u003e\n\u003cp\u003e再来看周末的各时间段流量分布走势，和工作日所不同的是，周末的流量早高峰期延后到了10点，这可能和各位小伙伴们周日作息较晚有关（同学们周末都是几点起床呢），除此之外，晚上的流量高峰退潮期也有延后。针对与周末用户流量分布的特性，互联网企业在周末时可以将活动开始时间和活动结束时间都适当进行延后，这个时候不能再套用工作日制定好的活动时间计划了，因为符合用户群体作息规律的推广促销活动才能达到更好的效果。\u003c/p\u003e\n\u003ch2\u003e2. 推广渠道流量分布\u003c/h2\u003e\n\u003cp\u003e电商推广渠道主要有三种：线上渠道（谷歌、百度等），线下渠道（活动、会议等），新媒体营销（微信、小红书等）。\u003c/p\u003e\n\u003cp\u003e通过对不同推广渠道的流量进行分析，我们可以清晰看出各个渠道对企业带来的价值占比差异，便于制定有针对性的营销策略。\u003cbr\u003e\u003cimg src=\"/images/blog/tech/business/image_2_4.png\" alt=\"image_2_4.png\"\u003e\u003c/p\u003e\n\u003cp\u003e如上图所示，由于推广渠道是分多层级的，我们通过FineBI工具的多层饼图进行数据的分析统计再合适不过了。分析下图的数据我们可以看出，首先是一级渠道的主要战斗力来自于新媒体营销，当今的微信、知乎等社交媒介社区时代受众广泛，用户群体非常庞大，是公司需要投入主要成本进行推广的。其次线上渠道的效果也不容忽视，对于互联网企业来说，做好百度、Google等SEO搜索引擎关键词推广也是很重要的一部分工作。相较于线上渠道和新媒体营销，线下渠道说所需要的经费和时间、人力成本较大，受众又相对较小，所以此类活动往往针对核心粉丝进行运营即可。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/blog/tech/business/image_2_5.png\" alt=\"image_2_5.png\"\u003e\u003c/p\u003e\n\u003ch2\u003e3. 访问深度用户群体分布\u003c/h2\u003e\n\u003cp\u003e这里涉及到跳失率的概念，即顾客通过相应入口进入，只访问了一个页面就离开的访问次数占该页面总访问次数的比例。跳失率=跳出次数/访问次数。跳失率越低，用户的访问越有深度。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/blog/tech/business/image_2_6.png\" alt=\"image_2_6.png\"\u003e\u003c/p\u003e\n\u003cp\u003e如上图所示，我们通过BI工具将企业的VIP用户、老用户、新用户分别进行分时间段的用户群体访问深度分析统计。总体来说可以发现平台的VIP用户访问深度较老用户以及新用户稍微高些，但是不是太明显，说明平台运营的VIP这部分群体的活跃度还有待提升。\u003c/p\u003e\n\u003cp\u003e同时，平台老用户访问深度和新用户更是相差无几，公司对于用户这方面的活跃运营明显需要加油了，建议将平台的部分忠诚度较高的老用户以VIP用户组建起来，共建平台生态圈，增加整体的用户活跃度。也可以向老用户以及VIP用户实施一些优惠政策，如定向商品折扣、根据用户画像进行喜好商品特惠推送等。\u003c/p\u003e\n\u003ch2\u003e4. 核心指标对比走势\u003c/h2\u003e\n\u003cp\u003e主要强调的是核心指标的动态变化。那什么是这里所提及的“核心指标”呢？\u003c/p\u003e\n\u003cp\u003e不管是电商还是其他互联网行业，往往都需要关注如下指标：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e浏览量-PV;\u003c/li\u003e\n\u003cli\u003e访问次数-Visits；\u003c/li\u003e\n\u003cli\u003e访客数-UV；\u003c/li\u003e\n\u003cli\u003e平均访问深度（总浏览量/访问次数），\u003c/li\u003e\n\u003cli\u003e平均停留时间（总停留时间/总浏览量），\u003c/li\u003e\n\u003cli\u003e跳失率（跳出次数/访问次数）。\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e其中，前面三个指标常常用来衡量流量数据的数量，后面三个指标则多用衡量流量指标的质量。通过对这些指标的动态分析，我们可以很好地评估某一时段推出的营销策略的效果。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/blog/tech/business/image_2_7.png\" alt=\"image_2_7.png\"\u003e\u003c/p\u003e\n\u003cp\u003e举个例子，我们仔细分析上图中的平台流量指标，可以发现10月份是2017全年的流量高峰期，应该跟企业在国庆黄金假期所做的促销引流活动有关。浏览量、跳失次数、访问次数分别为4941、1290、2182，对比计算可得到跳失率为59.12%，明显低于其他时间段的跳失率，说明10月份的活动效果还不错，其经验对以后的营销推广可以起到参考作用。\u003c/p\u003e\n\u003ch2\u003e02 转化\u003c/h2\u003e\n\u003cp\u003e在通过引流吸引到了新用户的目光之后，往往需要采取一系列的运营策略，实现用户的转化，也就是让用户搜索商品-浏览商品-下单商品-交易付款。在转化阶段，需要重点关注的指标有：下单转化率、事件转化率、服务转化率和退货率。\u003c/p\u003e\n\u003ch2\u003e1. 下单转化率\u003c/h2\u003e\n\u003cp\u003e对于平台经营方来说，我们希望一旦有用户流量进入平台网站，他们就能够顺利按照我们平台运营设定好的系列要求一步步进行下去，最终完成交易付款操作。那么对于互联网运营方来说，就需要做好用户在会员注册、商品收藏、购物车添加、交易付款等环节的转化操作。对于这样需要进行逐级转化的平台运营，我们首先可以通过漏斗图进行宏观的流程转化数据分析找出目前阶段最需要优化的运营环节，有效地进行针对性治理，最终提高整体平台用户下单转化率。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/blog/tech/business/image_2_8.png\" alt=\"image_2_8.png\"\u003e\u003c/p\u003e\n\u003cp\u003e以上面这个漏斗呈现的信息为例：\u003c/p\u003e\n\u003cp\u003e首先看用户从浏览商品行为到添加购物车行为这一流程的转化情况，通过漏斗图可以快速看出其转化率为50.77%，反映出该平台的商品介绍、图片描述等对用户有较强的吸引力。\u003c/p\u003e\n\u003cp\u003e接下来继续看添加购物车到下单的转化率，可以看出其转化率高达99.66%，非常不错。之后却看到单至付款的转化率仅50%，这是一个值得反思的转化节点，通过数据分析猜测该平台商铺支付渠道不完善，需要增加例如支付宝、微信等快捷支付渠道，降低平台因为没有提供用户习惯性的支付渠道而导致用户放弃购买行为的几率。\u003c/p\u003e\n\u003ch2\u003e2、事件转化率\u003c/h2\u003e\n\u003cp\u003e事件转化率通常指的是平台或商铺通过一系列的运营推广活动以及由于公共事件影响所带来的额外价值。这一指标对于平台运营评估和指导市场推广运营活动极为重要，例如网络营销总的SEO关键词投放、折扣促销活动、邮件营销等等效果跟踪。关于事件转化率方面的数据分析，通常我们可关注于营销渠道转化率、会员转化率、店铺流量转化率、下单转化率等指标进行活动的推广营销效果评估。\u003c/p\u003e\n\u003cp\u003e利用BI工具，首先分析出各个营销推广渠道的转化率环形玫瑰分布图。可以看出目前平台的转化率最高的渠道主要是基础上线工作、SEO关键词推广、微信推广、品牌推广几个渠道。同时我们想联动查看每个渠道对应的转化率数据时，通过BI工具提供的数据自动联动过滤功能让用户无需任何设置即可进行所有相关联的数据联动。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/blog/tech/business/image_2_9.png\" alt=\"image_2_9.png\"\u003e\u003c/p\u003e\n\u003cp\u003e除了以上渠道营销策略之外，对于平台商铺而言，合适的关联性商品推荐也能够提高用户对关联商品的购买率，比如用户在购买完服装之后可以再给他推送鞋子一类商品。另外关于事件转化率方面，由于季节性以及公共事件也会影响商品的下单转化率，针对不同时期较流行的商品进行进货营销往往才能够达到最大的盈利目的。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/blog/tech/business/image_2_10.png\" alt=\"image_2_10.png\"\u003e\u003c/p\u003e\n\u003ch2\u003e3、服务转化率\u003c/h2\u003e\n\u003cp\u003e服务转化率方面，通常用户在网上购买商品时，对于商品的一些细节品质以及发货渠道和速度等会需要做一些了解。那么良好的服务自然能够提高顾客的购买率，对于平台的客户人员，我们可以统计处其咨询到下单的节点转化率，并且以咨询到下单的转换率指标作为KPI指标之一来评价客服人员的工作绩效。\u003c/p\u003e\n\u003cp\u003e如下图所示，通过BI工具进行客服咨询下单转化率条形图的数据分析统计可以发现，该平台的Blanche、Henry、Christian、汉克、贝蒂这五名客服的转化率比较优秀，并且都在10%以上，其他的客服员工的转化率则相对较低，故而这方面可以让转化率最为优秀的Blanche客服给其他客服做一次服务培训，整体上提升平台的服务水平，进而提升用户的下单转化率。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/blog/tech/business/image_2_11.png\" alt=\"image_2_11.png\"\u003e\u003c/p\u003e\n\u003ch2\u003e4、退货率\u003c/h2\u003e\n\u003cp\u003e对于用户而言退货的原因通常可分为两大类，一类是由于买到的商品质量有问题而申请退货，另外一类可能是由于用户自身原因想申请退货。平台方往往更为需要关注第一类因为商品质量问题而申请退货的商品，通过历史商品的质量原因退货数据统计分析，对于确确实实是存在质量问题的商品需要及时反馈给供应商，质量过于严重的话可以考虑该类商品和供应商的协商库存退货。\u003c/p\u003e\n\u003ch2\u003e03 留存\u003c/h2\u003e\n\u003cp\u003e新用户转化成功，变成老用户之后，我们需要着重关注留存问题，简而言之就是关注怎么做才能留住客户的心。\u003c/p\u003e\n\u003cp\u003e我们可以从宏观上来定义平台的留存用户：在互联网行业中，用户在某段时间内开始使用应用，经过一段时间后，仍然继续使用该应用的用户，被认作是留存用户。我们往往希望留存用户越多越好。\u003c/p\u003e\n\u003cp\u003e一般来说，留存方面，需要关注如下指标：\u003c/p\u003e\n\u003ch2\u003e1. 次日/7日/30日留存\u003c/h2\u003e\n\u003cp\u003e即某天新增的用户中，在次日/7天后/30天后依然”活跃“（比如有浏览行为、收藏行为、购买行为等）的比例。\u003c/p\u003e\n\u003cp\u003e不同时长的留存率分析可以折射出不同的问题。一般而言，分析次日留存率有利于抓住产品的品质变动和渠道优势；7日留存率可以体现出一个较为完整的周期后的用户去留情况；30日留存率可以反应产品或渠道迭代后的稳定性，协助判断演进方向的合理性。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/blog/tech/business/image_2_12.png\" alt=\"image_2_12.png\"\u003e\u003c/p\u003e\n\u003ch2\u003e2. 渠道留存\u003c/h2\u003e\n\u003cp\u003e不同渠道的用户质量往往是不尽相同的。再考虑留存率的同时，对比留存渠道，可以进行更高质量的广告投放。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/blog/tech/business/image_2_13.png\" alt=\"image_2_13.png\"\u003e\u003c/p\u003e\n"])</script><script>self.__next_f.push([1,"17:T4704,"])</script><script>self.__next_f.push([1,"\u003cp\u003e\u003ca href=\"https://blog.csdn.net/u010482601/article/details/104989532\"\u003e转载\u003c/a\u003e\u003c/p\u003e\n\u003ch3\u003e1 为什么需要权限管理\u003c/h3\u003e\n\u003cp\u003e日常工作中权限的问题时时刻刻伴随着我们，程序员新入职一家公司需要找人开通各种权限，比如网络连接的权限、编码下载提交的权限、监控平台登录的权限、运营平台查数据的权限等等。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e在很多时候我们会觉得这么多繁杂的申请给工作带来不便，并且如果突然想要查一些数据，发现没有申请过权限，需要再走审批流程，时间拉得会很长。那为什么还需要这么严格的权限管理呢？\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e举个例子，一家支付公司有运营后台，运营后台可以查到所有的商户信息，法人代表信息，交易信息以及费率配置信息，如果我们把这些信息不加筛选都给到公司的每一个小伙伴，那么跑市场的都可以操作商家的费率信息，如果一个不小心把费率改了会造成巨大的损失。\u003c/p\u003e\n\u003cp\u003e又比如商户的信息都是非常隐秘的，有些居心不良的小伙伴把这些信息拿出来卖给商家的竞争对手，会给商家造成严重的不良后果。虽然这么做都是个别人人为的过错，但是制度上如果本身这些信息不开放出来就能在很大程度上避免违法乱纪的事情发生了。\u003c/p\u003e\n\u003cp\u003e总体来讲**权限管理是公司数据安全的重要保证，针对不同的岗位，不同的级别看到的数据是不一样的，操作数据的限制也是不一样的。**比如涉及到资金的信息只开放给财务的相关岗位，涉及到配置的信息只开放给运营的相关岗位，这样各司其职能避免很多不必要的安全问题。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e如何让各个岗位的人在系统上各司其职，就是权限管理要解决的问题。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3\u003e2 权限模型 \u003ca href=\"#2-quan-xian-mo-xing\" id=\"2-quan-xian-mo-xing\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003ch4\u003e\u003cstrong\u003e2.1 权限设计\u003c/strong\u003e \u003ca href=\"#21-quan-xian-she-ji\" id=\"21-quan-xian-she-ji\"\u003e\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e从业务分类上来讲权限可以分为数据查看权限，数据修改权限等，对应到系统设计中有页面权限、菜单权限、按钮权限等。菜单也分一级菜单、二级菜单甚至三级菜单，以csdn文章编辑页面左侧菜单栏为例是分了两级菜单。菜单对应的页面里又有很多按钮，我们在设计的时候最好把权限设计成树形结构，这样在申请权限的时候就可以一目了然的看到菜单的结构，需要哪些权限就非常的明了了。\u003c/p\u003e\n\u003cp\u003e如下图所示：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/blog/tech/business/image_1_0.png\" alt=\"image_1_0.png\"\u003e\u003c/p\u003e\n\u003cp\u003e按照这个架构，按钮的父级是二级菜单，二级菜单的父级是一级菜单，这样用户申请权限的时候非常清晰的看到自己需要哪些权限。\u003c/p\u003e\n\u003ch4\u003e\u003cstrong\u003e2.2 为什么需要角色\u003c/strong\u003e \u003ca href=\"#22-wei-shen-me-xu-yao-jiao-se\" id=\"22-wei-shen-me-xu-yao-jiao-se\"\u003e\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e权限结构梳理清晰之后，需要思考怎么把权限分配给用户，用户少的情况下，可以直接分配，一个用户可以有多个权限，统一一个权限可以被多个用户拥有，用户-权限的模型结构如下所示：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/blog/tech/business/image_1_1.png\" alt=\"image_1_1.png\"\u003e\u003c/p\u003e\n\u003cp\u003e这种模型能够满足权限的基本分配能力，但是随着用户数量的增长，这种模型的弊端就凸显出来了，每一个用户都需要去分配权限，非常的浪费管理员的时间和精力，并且用户和权限杂乱的对应关系会给后期带来巨大的维护成本。用户-权限对应关系图：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/blog/tech/business/image_1_2.png\" alt=\"image_1_2.png\"\u003e\u003c/p\u003e\n\u003cp\u003e这种对应关系在用户多的情况下基本无法维护了。其实很多用户负责同一个业务模块所需要的权限是一样的，这样的话我们是不是可以借助第三个媒介，把需要相同的权限都分配给这个媒介，然后用户和媒介关联起来，用户就拥有了媒介的权限了。这就是经典的RBAC模型，其中媒介就是我们通常所说的角色。\u003c/p\u003e\n\u003ch4\u003e\u003cstrong\u003e2.3 权限模型的演进\u003c/strong\u003e \u003ca href=\"#23-quan-xian-mo-xing-de-yan-jin\" id=\"23-quan-xian-mo-xing-de-yan-jin\"\u003e\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e\u003cstrong\u003e2.3.1 RBAC模型\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e有了角色之后可以把权限分配给角色，需要相同权限的用户和角色对应起来就可以了，一个权限可以分配给多个角色，一个角色可以拥有多个权限，同样一个用户可以分配多个角色，一个角色也可以对应多个用户，对应模型如下所示：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/blog/tech/business/image_1_3.png\" alt=\"image_1_3.png\"\u003e\u003c/p\u003e\n\u003cp\u003e这就是经典的RBAC模型了（role-based-access-control），在这里面角色起到了桥梁左右，连接了用户和权限的关系，每个角色可以拥有多个权限，每个用户可以分配多个角色，这样用户就拥有了多个角色的多个权限。\u003c/p\u003e\n\u003cp\u003e同时因为有角色作为媒介，大大降低了错综复杂的交互关系，比如一家有上万人的公司，角色可能只需要几百个就搞定了，因为很多用户需要的权限是一样的，分配一样的角色就可以了。这种模型的对应关系图如下所示：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/blog/tech/business/image_1_4.png\" alt=\"image_1_4.png\"\u003e\u003c/p\u003e\n\u003cp\u003e用户和角色，角色和权限都是多对多的关系，这种模型是最通用的权限管理模型，节省了很大的权限维护成本， 但是实际的业务千变万化，权限管理的模型也需要根据不同的业务模型适当的调整，比如一个公司内部的组织架构是分层级的，层级越高权限越大，因为层级高的人不仅要拥有自己下属拥有的权限，二期还要有一些额外的权限。\u003c/p\u003e\n\u003cp\u003eRBAC模型可以给不同层级的人分配不同的角色，层级高的对应角色的权限就多，这样的处理方式可以解决问题，但是有没有更好的解决办法呢，答案肯定是有的，这就引出\u003cstrong\u003e角色继承的RBAC模型\u003c/strong\u003e。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e2.3.2 角色继承的RBAC模型\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e角色继承的RBAC模型又称RBAC1模型。每个公司都有自己的组织架构，比如公司里管理财务的人员有财务总监、财务主管、出纳员等，财务主管需要拥有但不限于出纳员的权限，财务总监需要拥有但不限于财务主管的权限，像这种管理关系向下兼容的模式就需要用到角色继承的RBAC模型。\u003cstrong\u003e角色继承的RBAC模型的思路是上层角色继承下层角色的所有权限，并且可以额外拥有其他权限。\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e模型如下所示：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/blog/tech/business/image_1_5.png\" alt=\"image_1_5.png\"\u003e\u003c/p\u003e\n\u003cp\u003e从模型图中可以看出下级角色拥有的权限，上级角色都拥有，并且上级角色可以拥有其他的权限。角色的层级关系可以分为两种，一种是下级角色只能拥有一个上级角色，但是上级角色可以拥有多个下级角色，这种结构用图形表示是一个树形结构，如下图所示：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/blog/tech/business/image_1_6.png\" alt=\"image_1_6.png\"\u003e\u003c/p\u003e\n\u003cp\u003e还有一种关系是下级角色可以拥有多个上级角色，上级角色也可以拥有多个下级角色，这种结构用图形表示是一个有向无环图，如下图所示：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/blog/tech/business/image_1_7.png\" alt=\"image_1_7.png\"\u003e\u003c/p\u003e\n\u003cp\u003e树形图是我们比较常用的，因为一个用户一般情况下不会同时有多个直属上级，比如财务部只能有一个财务总监，但是可以有多个财务主管和收纳员。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e2.3.3 带约束的RBAC模型\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e带约束的RBAC模型又成RBAC2模型。在实际工作中，为了安全的考虑会有很多约束条件，比如财务部里同一个人不能即是会计又是审核员，跟一个人同一时间不能即是运动员又是裁判员是一个道理的，又比如财务部的审核员不能超过2个，不能1个也没有。因为角色和权限是关联的，所以我们做好角色的约束就可以了。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e常见的约束条件有：角色互斥、基数约束、先决条件约束等。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cstrong\u003e角色互斥：\u003c/strong\u003e 如果角色A和角色B是互斥关系的话，那么一个用户同一时间不能即拥有角色A，又拥有角色B，只能拥有其中的一个角色。\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e比如我们给一个用户赋予了会计的角色就不能同时再赋予审核员的角色，如果想拥有审核员的角色就必须先去掉会计的角色。假设提交角色和审核角色是互质的，我们可以用图形表示：\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cimg src=\"/images/blog/tech/business/image_1_8.png\" alt=\"image_1_8.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e基数约束：\u003c/strong\u003e 同一个角色被分配的用户数量可以被限制，比如规定拥有超级管理员角色的用户有且只有1个；用户被分配的角色数量也需要被限制，角色被分配的权限数量也可以被限制。\u003c/p\u003e\n\u003cp\u003e**先决条件约束：**用户想被赋予上级角色，首先需要拥有下级角色，比如技术负责人的角色和普通技术员工角色是上下级关系，那么用户想要用户技术负责人的角色就要先拥有普通技术员工的角色。\u003c/p\u003e\n\u003ch4\u003e\u003cstrong\u003e2.4 用户划分\u003c/strong\u003e \u003ca href=\"#24-yong-hu-hua-fen\" id=\"24-yong-hu-hua-fen\"\u003e\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e\u003cstrong\u003e2.4.1 用户组\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e我们创建角色是为了解决用户数量大的情况下，用户分配权限繁琐以及用户-权限关系维护成本高的问题。抽象出一个角色，把需要一起操作的权限分配给这个角色，把角色赋予用户，用户就拥有了角色上的权限，这样避免了一个个的给用户分配权限，节省了大量的资源。\u003c/p\u003e\n\u003cp\u003e同样的如果有一批用户需要相同的角色，我们也需要一个个的给用户分配角色，比如一个公司的客服部门有500多个人，有一天研发部研发了一套查询后台数据的产品，客服的小伙伴都需要使用，但是客服由于之前并没有统一的一个角色给到所有的客服小伙伴，这时候需要新加一个角色，把权限分配给该角色，然后再把角色一个个分配给客服人员，这时候会发现给500个用户一个个添加角色非常的麻烦。但是客服人员又有共同的属性，所以我们可以创建一个用户组，所有的客服人员都属于客服用户组，把角色分配给客服用户组，这个用户组下面的所有用户就拥有了需要的权限。\u003c/p\u003e\n\u003cp\u003eRBAC模型添加用户组之后的模型图如下所示：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/blog/tech/business/image_1_9.png\" alt=\"image_1_9.png\"\u003e\u003c/p\u003e\n\u003cp\u003e很多朋友会问，用户组和角色有什么区别呢？简单的来说，\u003cstrong\u003e用户组是一群用户的组合，而角色是用户和权限之间的桥梁。\u003c/strong\u003e 用户组把相同属性的用户组合起来，比如同一个项目的开发、产品、测试可以是一个用户组，同一个部门的相同职位的员工可以是一个用户组， 一个用户组可以是一个职级，可以是一个部门，可以是一起做事情的来自不同岗位的人。\u003c/p\u003e\n\u003cp\u003e用户可以分组，权限也可以分组，权限特别多的情况下，可以把一个模块的权限组合起来成为一个权限组，权限组也是解决权限和角色对应关系复杂的问题。\u003c/p\u003e\n\u003cp\u003e比如我们定义权限的时候一级菜单、二级菜单、按钮都可以是权限，一个一级菜单下面有几十个二级菜单，每个二级菜单下面又有几十个按钮，这时候我们把权限一个个分配给角色也是非常麻烦的，可以采用分组的方法把权限分组，然后把分好的组赋予角色就可以了。\u003c/p\u003e\n\u003cp\u003e给权限分组也是个技术活，需要理清楚权限之间的关系，比如支付的运营后台我们需要查各种信息，账务的数据、订单的数据、商户的数据等等，这些查询的数据并不在一个页面，每个页面也有很多按钮，我们可以把这几个页面以及按钮对应的权限组合成一个权限组赋予角色。加入权限组之后的RBAC模型如下所示：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/blog/tech/business/image_1_10.png\" alt=\"image_1_10.png\"\u003e\u003c/p\u003e\n\u003cp\u003e实际工作中我们很少给权限分组，给用户分组的场景会多一些，有的时候用户组也可以直接和权限关联，这个看实际的业务场景是否需要，权限模型没有统一的，业务越复杂业务模型会约多样化。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e2.4.2 组织\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e每个公司都有自己的组织架构，很多时候权限的分配可以根据组织架构来划分。因为同一个组织内的小伙伴使用的大部分权限是一样的。如下所示一个公司的组织架构图：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/blog/tech/business/image_1_11.png\" alt=\"image_1_11.png\"\u003e\u003c/p\u003e\n\u003cp\u003e按照这个组织架构，每一个组织里的成员使用的基础权限很可能是一样的，比如人力资源都需要看到人才招聘的相关信息，市场推广都需要看到行业分析的相关信息，按照组织来分配角色会有很多优势：\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e实现权限分配的自动化：\u003c/strong\u003e 和组织关系打通之后，按照组织来分配角色，如果有新入职的用户，被划分在某个组织下面之后，会自动获取该组织下所有的权限，无需人工分配。又比如有用户调岗，只需要把组织关系调整就可以了，权限会跟着组织关系自动调整，也无需人工干预。这么做首先需要把权限和组织关系打通。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e控制数据权限：\u003c/strong\u003e 把角色关联到组织，组织里的成员只能看到本组织下的数据，比如市场推广和大客定制，市场推广针对的是零散的客户，大可定制针对的是有一定体量的客户，相互的数据虽然在一个平台，但是只能看自己组织下的数据。\u003c/p\u003e\n\u003cp\u003e加入组织之后的RBAC模型如下所示：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/blog/tech/business/image_1_12.png\" alt=\"image_1_12.png\"\u003e\u003c/p\u003e\n\u003cp\u003e用户可以在多个组织中，因为组织也有层级结构，一个组织里只可以有多个用户，所以用户和组织的关系是多对多的关系，组织和角色的关系是一对一的关系。这个在工作中可以根据实际情况来确定对应关系。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e2.4.3 职位\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e一个组织下面会有很多职位，比如财务管理会有财务总监、财务主管、会计、出纳员等职位，每个职位需要的权限是不一样的，可以像组织那样根据职位来分配不同的角色，由于一个人的职位是固定的，所以用户跟职位的对应关系时一对一的关系，职位跟角色的对应关系可以是多对多的关系。加入职位的RBAC模型如下所示：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/blog/tech/business/image_1_13.png\" alt=\"image_1_13.png\"\u003e\u003c/p\u003e\n\u003ch4\u003e\u003cstrong\u003e2.5 理想的RBAC模型\u003c/strong\u003e \u003ca href=\"#25-li-xiang-de-rbac-mo-xing\" id=\"25-li-xiang-de-rbac-mo-xing\"\u003e\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003eRBAC模型根据不同业务场景的需要会有很多种演变，实际工作中业务是非常复杂的，权限分配也是非常复杂的，想要做出通用且高效的模型很困难。我们把RBAC模型的演变汇总起来会是一个支撑大数据量以及复杂业务的理想的模型。把RBAC、RBAC1、RBAC2、用户组、组织、职位汇总起来的模型如下所示：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/blog/tech/business/image_1_14.png\" alt=\"image_1_14.png\"\u003e\u003c/p\u003e\n\u003cp\u003e按照这个模型基本上能够解决所有的权限问题，其中的对应关系可以根据实际的业务情况来确定，一般情况下，组织和职位是一对多的关系，特殊情况下可以有多对多的情况，需要根据实际情况来定。\u003c/p\u003e\n\u003cp\u003e理想的RBAC模型并不是说我们一开始建权限模型就可以这么做，而是数据体量、业务复杂度达到一定程度之后可以使用这个模型来解决权限的问题，如果数据量特别少，比如刚成立的公司只有十几个人，那完全可以用用户-权限模型，都没有必要使用RBAC模型。\u003c/p\u003e\n\u003ch3\u003e3 权限系统表设计 \u003ca href=\"#3-quan-xian-xi-tong-biao-she-ji\" id=\"3-quan-xian-xi-tong-biao-she-ji\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003ch4\u003e\u003cstrong\u003e3.1 标准RBAC模型表设计\u003c/strong\u003e \u003ca href=\"#31-biao-zhun-rbac-mo-xing-biao-she-ji\" id=\"31-biao-zhun-rbac-mo-xing-biao-she-ji\"\u003e\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e标准RBAC模型的表是比较简单了，要表示\u003ccode\u003e用户-角色-权限\u003c/code\u003e三者之前的关系，首先要创建用户表、角色表、权限表，用户和角色是多对多的关系，角色和权限是多对多的关系，需要再创建两章关系表，分别是用户-角色关系表和角色-权限关系表。这六张表的ER图如下所示：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/blog/tech/business/image_1_15.png\" alt=\"image_1_15.png\"\u003e\u003c/p\u003e\n\u003ch4\u003e\u003cstrong\u003e3.2 理想RBAC模型表设计\u003c/strong\u003e \u003ca href=\"#32-li-xiang-rbac-mo-xing-biao-she-ji\" id=\"32-li-xiang-rbac-mo-xing-biao-she-ji\"\u003e\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e理想的RBAC模型是标准RBAC模型经过多次扩展得到的，表结构也会比较复杂，因为要维护很多关系，如下图所示是理想的RBAC模型的ER图：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/blog/tech/business/image_1_16.png\" alt=\"image_1_16.png\"\u003e\u003c/p\u003e\n\u003cp\u003e这里面需要强调的是角色互斥表，互斥的关系可以放在角色上，也可以放在权限上，看实际工作的需求。\u003c/p\u003e\n\u003ch3\u003e4 结语 \u003ca href=\"#4-jie-yu\" id=\"4-jie-yu\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003e本文从易到难非常详细的介绍了权限模型的设计，在工作中需要根据实际情况来定义模型，千人以内的公司使用RBAC模型是完全够用的，没有必要吧权限模型设计的过于复杂。模型的选择要根据具体情况，比如公司体量、业务类型、人员数量等。总之最适合自己公司的模型就是最好的模型，权限模式和设计模式是一样的，都是为了更好的解决问题，不要为了使用模型而使用模型。\u003c/p\u003e\n"])</script><script>self.__next_f.push([1,"18:T8239,"])</script><script>self.__next_f.push([1,"\u003ch3\u003e整体思考 \u003ca href=\"#item-0-2\" id=\"item-0-2\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003ch4\u003e1 秒杀存在的问题 \u003ca href=\"#item-0-3\" id=\"item-0-3\"\u003e\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e对于一个日常平稳的业务系统，如果直接开通秒杀功能的话，往往会出现很多问题——\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e干系人\u003c/th\u003e\n\u003cth\u003e问题分类\u003c/th\u003e\n\u003cth\u003e业务出现的问题\u003c/th\u003e\n\u003cth\u003e设计要求\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\u003ctr\u003e\n\u003ctd\u003e用户\u003c/td\u003e\n\u003ctd\u003e体验较差\u003c/td\u003e\n\u003ctd\u003e秒杀开始，系统瞬间承受平时数十倍甚至上百倍的流量，直接宕掉\u003c/td\u003e\n\u003ctd\u003e高性能\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003e用户下单后却付不了款，显示商品已经被其他人买走了\u003c/td\u003e\n\u003ctd\u003e一致性\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e商家\u003c/td\u003e\n\u003ctd\u003e商品超卖\u003c/td\u003e\n\u003ctd\u003e100 件商品，却出现 200 人下单成功，成功下单买到商品的人数远远超过活动商品数量的上限\u003c/td\u003e\n\u003ctd\u003e一致性\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003e资金受损\u003c/td\u003e\n\u003ctd\u003e竞争对手通过恶意下单的方式将活动商品全部下单，导致库存清零，商家无法正常售卖\u003c/td\u003e\n\u003ctd\u003e高可用\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003e秒杀器猖獗，黄牛通过秒杀器扫货，商家无法达到营销目的\u003c/td\u003e\n\u003ctd\u003e高可用\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e平台\u003c/td\u003e\n\u003ctd\u003e风险不可控\u003c/td\u003e\n\u003ctd\u003e系统的其它与秒杀活动不相关的模块变得异常缓慢，业务影响面扩散\u003c/td\u003e\n\u003ctd\u003e高可用\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003e拖垮网站\u003c/td\u003e\n\u003ctd\u003e在线人数创新高，核心链路涉及的上下游服务从前到后都在告警\u003c/td\u003e\n\u003ctd\u003e高性能\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003e库存只有一份，所有请求集中读写同一个数据，DB 出现单点\u003c/td\u003e\n\u003ctd\u003e高性能\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\u003c/table\u003e\n\u003ch4\u003e2 设计方向的思考 \u003ca href=\"#item-0-4\" id=\"item-0-4\"\u003e\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e秒杀本质是要求一个瞬时高发下的承压系统，这也是其区别于其他业务的核心场景。对日常系统秒杀产生的问题逐一进行拆解分类，秒杀对应到架构设计，其实就是高可用、一致性和高性能的要求。关于秒杀系统的设计思考，本文即基于此 3 层依次推进，简述如下——\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e高性能。 秒杀涉及高读和高写的支持，如何支撑高并发，如何抵抗高IOPS？核心优化理念其实是类似的：高读就尽量\u0026quot;少读\u0026quot;或\u0026quot;读少\u0026quot;，高写就数据拆分。本文将从动静分离、热点优化以及服务端性能优化 3 个方面展开\u003c/li\u003e\n\u003cli\u003e一致性。 秒杀的核心关注是商品库存，有限的商品在同一时间被多个请求同时扣减，而且要保证准确性，显而易见是一个难题。如何做到既不多又不少？本文将从业界通用的几种减库存方案切入，讨论一致性设计的核心逻辑\u003c/li\u003e\n\u003cli\u003e高可用。 大型分布式系统在实际运行过程中面对的工况是非常复杂的，业务流量的突增、依赖服务的不稳定、应用自身的瓶颈、物理资源的损坏等方方面面都会对系统的运行带来大大小小的的冲击。如何保障应用在复杂工况环境下还能高效稳定运行，如何预防和面对突发问题，系统设计时应该从哪些方面着手？本文将从架构落地的全景视角进行关注思考\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003e高性能 \u003ca href=\"#item-0-5\" id=\"item-0-5\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003ch4\u003e1 动静分离 \u003ca href=\"#item-0-6\" id=\"item-0-6\"\u003e\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e大家可能会注意到，秒杀过程中你是不需要刷新整个页面的，只有时间在不停跳动。这是因为一般都会对大流量的秒杀系统做系统的静态化改造，即数据意义上的动静分离。动静分离三步走：1、数据拆分；2、静态缓存；3、数据整合。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e1.1 数据拆分\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e动静分离的首要目的是将动态页面改造成适合缓存的静态页面。因此第一步就是分离出动态数据，主要从以下 2 个方面进行：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e用户。用户身份信息包括登录状态以及登录画像等，相关要素可以单独拆分出来，通过动态请求进行获取；与之相关的广平推荐，如用户偏好、地域偏好等，同样可以通过异步方式进行加载\u003c/li\u003e\n\u003cli\u003e时间。秒杀时间是由服务端统一管控的，可以通过动态请求进行获取\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e这里你可以打开电商平台的一个秒杀页面，看看这个页面里都有哪些动静数据。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e1.2 静态缓存\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e分离出动静态数据之后，第二步就是将静态数据进行合理的缓存，由此衍生出两个问题：1、怎么缓存；2、哪里缓存\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e1.2.1 怎么缓存\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e静态化改造的一个特点是直接缓存整个 HTTP 连接而不是仅仅缓存静态数据，如此一来，Web 代理服务器根据请求 URL，可以直接取出对应的响应体然后直接返回，响应过程无需重组 HTTP 协议，也无需解析 HTTP 请求头。而作为缓存键，URL唯一化是必不可少的，只是对于商品系统，URL 天然是可以基于商品 ID 来进行唯一标识的，比如淘宝的 \u003ca href=\"https://link.segmentfault.com/?enc=MYTx%2B1O98e0H2OhCbw2yrg%3D%3D.eRmrBGs8O3Hv0%2BVZ4yO3J8RpgwhKne1xP0L6oRT4KFKWY4nTZucRo5o6QTC3xhtN\"\u003ehttps://item.taobao.com/item....\u003c/a\u003e。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e1.2.2 哪里缓存\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e静态数据缓存到哪里呢？可以有三种方式：1、浏览器；2、CDN ；3、服务端。\u003c/p\u003e\n\u003cp\u003e浏览器当然是第一选择，但用户的浏览器是不可控的，主要体现在如果用户不主动刷新，系统很难主动地把消息推送给用户（注意，当讨论静态数据时，潜台词是 “相对不变”，言外之意是 “可能会变”），如此可能会导致用户端在很长一段时间内看到的信息都是错误的。对于秒杀系统，保证缓存可以在秒级时间内失效是不可或缺的。\u003c/p\u003e\n\u003cp\u003e服务端主要进行动态逻辑计算及加载，本身并不擅长处理大量连接，每个连接消耗内存较多，同时 Servlet 容器解析 HTTP 较慢，容易侵占逻辑计算资源；另外，静态数据下沉至此也会拉长请求路径。\u003c/p\u003e\n\u003cp\u003e因此通常将静态数据缓存在 CDN，其本身更擅长处理大并发的静态文件请求，既可以做到主动失效，又离用户尽可能近，同时规避 Java 语言层面的弱点。需要注意的是，上 CDN 有以下几个问题需要解决：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e失效问题。任何一个缓存都应该是有时效的，尤其对于一个秒杀场景。所以，系统需要保证全国各地的 CDN 在秒级时间内失效掉缓存信息，这实际对 CDN 的失效系统要求是很高的\u003c/li\u003e\n\u003cli\u003e命中率问题。高命中是缓存系统最为核心的性能要求，不然缓存就失去了意义。如果将数据放到全国各地的 CDN ，势必会导致请求命中同一个缓存的可能性降低，那么命中率就成为一个问题\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e因此，将数据放到全国所有的 CDN 节点是不太现实的，失效问题、命中率问题都会面临比较大的挑战。更为可行的做法是选择若干 CDN 节点进行静态化改造，节点的选取通常需要满足以下几个条件：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e临近访问量集中的地区\u003c/li\u003e\n\u003cli\u003e距离主站较远的地区\u003c/li\u003e\n\u003cli\u003e节点与主站间网络质量良好的地区\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e基于以上因素，选择 CDN 的二级缓存比较合适，因为二级缓存数量偏少，容量也更大，访问量相对集中，这样就可以较好解决缓存的失效问题以及命中率问题，是当前比较理想的一种 CDN 化方案。部署方式如下图所示：\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/blog/tech/system/image_1_2.png\" alt=\"image_1_2.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e1.3 数据整合\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e分离出动静态数据之后，前端如何组织数据页就是一个新的问题，主要在于动态数据的加载处理，通常有两种方案：ESI（Edge Side Includes）方案和 CSI（Client Side Include）方案。\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eESI 方案：Web 代理服务器上请求动态数据，并将动态数据插入到静态页面中，用户看到页面时已经是一个完整的页面。这种方式对服务端性能要求高，但用户体验较好\u003c/li\u003e\n\u003cli\u003eCSI 方案：Web 代理服务器上只返回静态页面，前端单独发起一个异步 JS 请求动态数据。这种方式对服务端性能友好，但用户体验稍差\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cstrong\u003e1.4 小结\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e动静分离对于性能的提升，抽象起来只有两点，一是数据要尽量少，以便减少没必要的请求，二是路径要尽量短，以便提高单次请求的效率。具体方法其实就是基于这个大方向进行的。\u003c/p\u003e\n\u003ch4\u003e2 热点优化 \u003ca href=\"#item-0-7\" id=\"item-0-7\"\u003e\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e热点分为热点操作和热点数据，以下分开进行讨论。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e2.1 热点操作\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e零点刷新、零点下单、零点添加购物车等都属于热点操作。热点操作是用户的行为，不好改变，但可以做一些限制保护，比如用户频繁刷新页面时进行提示阻断。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e2.2 热点数据\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e热点数据的处理三步走，一是热点识别，二是热点隔离，三是热点优化。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e2.2.1 热点识别\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e热点数据分为静态热点和动态热点，具体如下：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e静态热点：能够提前预测的热点数据。大促前夕，可以根据大促的行业特点、活动商家等纬度信息分析出热点商品，或者通过卖家报名的方式提前筛选；另外，还可以通过技术手段提前预测，例如对买家每天访问的商品进行大数据计算，然后统计出 TOP N 的商品，即可视为热点商品\u003c/li\u003e\n\u003cli\u003e动态热点：无法提前预测的热点数据。冷热数据往往是随实际业务场景发生交替变化的，尤其是如今直播卖货模式的兴起——带货商临时做一个广告，就有可能导致一件商品在短时间内被大量购买。由于此类商品日常访问较少，即使在缓存系统中一段时间后也会被逐出或过期掉，甚至在db中也是冷数据。瞬时流量的涌入，往往导致缓存被击穿，请求直接到达DB，引发DB压力过大\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e因此秒杀系统需要实现热点数据的动态发现能力，一个常见的实现思路是：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e异步采集交易链路各个环节的热点 Key 信息，如 Nginx采集访问URL或 Agent 采集热点日志（一些中间件本身已具备热点发现能力），提前识别潜在的热点数据\u003c/li\u003e\n\u003cli\u003e聚合分析热点数据，达到一定规则的热点数据，通过订阅分发推送到链路系统，各系统根据自身需求决定如何处理热点数据，或限流或缓存，从而实现热点保护\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e需要注意的是：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e热点数据采集最好采用异步方式，一方面不会影响业务的核心交易链路，一方面可以保证采集方式的通用性\u003c/li\u003e\n\u003cli\u003e热点发现最好做到秒级实时，这样动态发现才有意义，实际上也是对核心节点的数据采集和分析能力提出了较高的要求\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cstrong\u003e2.2.2 热点隔离\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e热点数据识别出来之后，第一原则就是将热点数据隔离出来，不要让 1% 影响到另外的 99%，可以基于以下几个层次实现热点隔离：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e业务隔离。秒杀作为一种营销活动，卖家需要单独报名，从技术上来说，系统可以提前对已知热点做缓存预热\u003c/li\u003e\n\u003cli\u003e系统隔离。系统隔离是运行时隔离，通过分组部署和另外 99% 进行分离，另外秒杀也可以申请单独的域名，入口层就让请求落到不同的集群中\u003c/li\u003e\n\u003cli\u003e数据隔离。秒杀数据作为热点数据，可以启用单独的缓存集群或者DB服务组，从而更好的实现横向或纵向能力扩展\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e当然，实现隔离还有很多种办法。比如，可以按照用户来区分，为不同的用户分配不同的 Cookie，入口层路由到不同的服务接口中；再比如，域名保持一致，但后端调用不同的服务接口；又或者在数据层给数据打标进行区分等等，这些措施的目的都是把已经识别的热点请求和普通请求区分开来。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e2.2.3 热点优化\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e热点数据隔离之后，也就方便对这 1% 的请求做针对性的优化，方式无外乎两种：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e缓存：热点缓存是最为有效的办法。如果热点数据做了动静分离，那么可以长期缓存静态数据\u003c/li\u003e\n\u003cli\u003e限流：流量限制更多是一种保护机制。需要注意的是，各服务要时刻关注请求是否触发限流并及时进行review\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cstrong\u003e2.2.4 小结\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e数据的热点优化与动静分离是不一样的，热点优化是基于二八原则对数据进行了纵向拆分，以便进行针对性地处理。热点识别和隔离不仅对“秒杀”这个场景有意义，对其他的高性能分布式系统也非常有参考价值。\u003c/p\u003e\n\u003ch4\u003e3 系统优化 \u003ca href=\"#item-0-8\" id=\"item-0-8\"\u003e\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e对于一个软件系统，提高性能可以有很多种手段，如提升硬件水平、调优JVM 性能，这里主要关注代码层面的性能优化——\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e减少序列化：减少 Java 中的序列化操作可以很好的提升系统性能。序列化大部分是在 RPC 阶段发生，因此应该尽量减少 RPC 调用，一种可行的方案是将多个关联性较强的应用进行 “合并部署”，从而减少不同应用之间的 RPC 调用（微服务设计规范）\u003c/li\u003e\n\u003cli\u003e直接输出流数据：只要涉及字符串的I/O操作，无论是磁盘 I/O 还是网络 I/O，都比较耗费 CPU 资源，因为字符需要转换成字节，而这个转换又必须查表编码。所以对于常用数据，比如静态字符串，推荐提前编码成字节并缓存，具体到代码层面就是通过 OutputStream() 类函数从而减少数据的编码转换；另外，热点方法toString()不要直接调用ReflectionToString实现，推荐直接硬编码，并且只打印DO的基础要素和核心要素\u003c/li\u003e\n\u003cli\u003e裁剪日志异常堆栈：无论是外部系统异常还是应用本身异常，都会有堆栈打出，超大流量下，频繁的输出完整堆栈，只会加剧系统当前负载。可以通过日志配置文件控制异常堆栈输出的深度\u003c/li\u003e\n\u003cli\u003e去组件框架：极致优化要求下，可以去掉一些组件框架，比如去掉传统的 MVC 框架，直接使用 Servlet 处理请求。这样可以绕过一大堆复杂且用处不大的处理逻辑，节省毫秒级的时间，当然，需要合理评估你对框架的依赖程度\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch4\u003e4 总结一下 \u003ca href=\"#item-0-9\" id=\"item-0-9\"\u003e\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e性能优化需要一个基准值，所以系统还需要做好应用基线，比如性能基线（何时性能突然下降）、成本基线（去年大促用了多少机器）、链路基线（核心流程发生了哪些变化），通过基线持续关注系统性能，促使系统在代码层面持续提升编码质量、业务层面及时下掉不合理调用、架构层面不断优化改进。\u003c/p\u003e\n\u003ch3\u003e一致性 \u003ca href=\"#item-0-10\" id=\"item-0-10\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003e秒杀系统中，库存是个关键数据，卖不出去是个问题，超卖更是个问题。秒杀场景下的一致性问题，主要就是库存扣减的准确性问题。\u003c/p\u003e\n\u003ch4\u003e1 减库存的方式 \u003ca href=\"#item-0-11\" id=\"item-0-11\"\u003e\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e电商场景下的购买过程一般分为两步：下单和付款。“提交订单”即为下单，“支付订单”即为付款。基于此设定，减库存一般有以下几个方式：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e下单减库存。买家下单后，扣减商品库存。下单减库存是最简单的减库存方式，也是控制最为精确的一种\u003c/li\u003e\n\u003cli\u003e付款减库存。买家下单后，并不立即扣减库存，而是等到付款后才真正扣减库存。但因为付款时才减库存，如果并发比较高，可能出现买家下单后付不了款的情况，因为商品已经被其他人买走了\u003c/li\u003e\n\u003cli\u003e预扣库存。这种方式相对复杂一些，买家下单后，库存为其保留一定的时间（如 15 分钟），超过这段时间，库存自动释放，释放后其他买家可以购买\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e能够看到，减库存方式是基于购物过程的多阶段进行划分的，但无论是在下单阶段还是付款阶段，都会存在一些问题，下面进行具体分析。\u003c/p\u003e\n\u003ch4\u003e2 减库存的问题 \u003ca href=\"#item-0-12\" id=\"item-0-12\"\u003e\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e\u003cstrong\u003e2.1 下单减库存\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e优势：用户体验最好。下单减库存是最简单的减库存方式，也是控制最精确的一种。下单时可以直接通过数据库事务机制控制商品库存，所以一定不会出现已下单却付不了款的情况。\u003c/p\u003e\n\u003cp\u003e劣势：可能卖不出去。正常情况下，买家下单后付款概率很高，所以不会有太大问题。但有一种场景例外，就是当卖家参加某个促销活动时，竞争对手通过恶意下单的方式将该商品全部下单，导致库存清零，那么这就不能正常售卖了——要知道，恶意下单的人是不会真正付款的，这正是 “下单减库存” 的不足之处。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e2.2 付款减库存\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e优势：一定实际售卖。“下单减库存” 可能导致恶意下单，从而影响卖家的商品销售， “付款减库存” 由于需要付出真金白银，可以有效避免。\u003c/p\u003e\n\u003cp\u003e劣势：用户体验较差。用户下单后，不一定会实际付款，假设有 100 件商品，就可能出现 200 人下单成功的情况，因为下单时不会减库存，所以也就可能出现下单成功数远远超过真正库存数的情况，这尤其会发生在大促的热门商品上。如此一来就会导致很多买家下单成功后却付不了款，购物体验自然是比较差的。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e2.3 预扣库存\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e优势：缓解了以上两种方式的问题。预扣库存实际就是“下单减库存”和 “付款减库存”两种方式的结合，将两次操作进行了前后关联，下单时预扣库存，付款时释放库存。\u003c/p\u003e\n\u003cp\u003e劣势：并没有彻底解决以上问题。比如针对恶意下单的场景，虽然可以把有效付款时间设置为 10 分钟，但恶意买家完全可以在 10 分钟之后再次下单。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e2.4 小结\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e减库存的问题主要体现在用户体验和商业诉求两方面，其本质原因在于购物过程存在两步甚至多步操作，在不同阶段减库存，容易存在被恶意利用的漏洞。\u003c/p\u003e\n\u003ch4\u003e3 实际如何减库存 \u003ca href=\"#item-0-13\" id=\"item-0-13\"\u003e\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e业界最为常见的是预扣库存。无论是外卖点餐还是电商购物，下单后一般都有个 “有效付款时间”，超过该时间订单自动释放，这就是典型的预扣库存方案。但如上所述，预扣库存还需要解决恶意下单的问题，保证商品卖的出去；另一方面，如何避免超卖，也是一个痛点。\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e卖的出去：恶意下单的解决方案主要还是结合安全和反作弊措施来制止。比如，识别频繁下单不付款的买家并进行打标，这样可以在打标买家下单时不减库存；再比如为大促商品设置单人最大购买件数，一人最多只能买 N 件商品；又或者对重复下单不付款的行为进行次数限制阻断等\u003c/li\u003e\n\u003cli\u003e避免超卖：库存超卖的情况实际分为两种。对于普通商品，秒杀只是一种大促手段，即使库存超卖，商家也可以通过补货来解决；而对于一些商品，秒杀作为一种营销手段，完全不允许库存为负，也就是在数据一致性上，需要保证大并发请求时数据库中的库存字段值不能为负，一般有多种方案：一是在通过事务来判断，即保证减后库存不能为负，否则就回滚；二是直接设置数据库字段类型为无符号整数，这样一旦库存为负就会在执行 SQL 时报错；三是使用 CASE WHEN 判断语句——\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre\u003e\u003ccode class=\"language-sql\"\u003eUPDATE item SET inventory = CASE WHEN inventory \u0026gt;= xxx THEN inventory-xxx ELSE inventory END\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e业务手段保证商品卖的出去，技术手段保证商品不会超卖，库存问题从来就不是简单的技术难题，解决问题的视角是多种多样的。\u003c/p\u003e\n\u003ch4\u003e4 一致性性能的优化 \u003ca href=\"#item-0-14\" id=\"item-0-14\"\u003e\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e库存是个关键数据，更是个热点数据。对系统来说，热点的实际影响就是 “高读” 和 “高写”，也是秒杀场景下最为核心的一个技术难题。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e4.1 高并发读\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e秒杀场景解决高并发读问题，关键词是“分层校验”。即在读链路时，只进行不影响性能的检查操作，如用户是否具有秒杀资格、商品状态是否正常、用户答题是否正确、秒杀是否已经结束、是否非法请求等，而不做一致性校验等容易引发瓶颈的检查操作；直到写链路时，才对库存做一致性检查，在数据层保证最终准确性。\u003c/p\u003e\n\u003cp\u003e因此，在分层校验设定下，系统可以采用分布式缓存甚至LocalCache来抵抗高并发读。即允许读场景下一定的脏数据，这样只会导致少量原本无库存的下单请求被误认为是有库存的，等到真正写数据时再保证最终一致性，由此做到高可用和一致性之间的平衡。\u003c/p\u003e\n\u003cp\u003e实际上，分层校验的核心思想是：不同层次尽可能过滤掉无效请求，只在“漏斗” 最末端进行有效处理，从而缩短系统瓶颈的影响路径。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e4.2 高并发写\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e高并发写的优化方式，一种是更换DB选型，一种是优化DB性能，以下分别进行讨论。\u003c/p\u003e\n\u003cp\u003e4.2.1 更换DB选型\u003c/p\u003e\n\u003cp\u003e秒杀商品和普通商品的减库存是有差异的，核心区别在数据量级小、交易时间短，因此能否把秒杀减库存直接放到缓存系统中实现呢，也就是直接在一个带有持久化功能的缓存中进行减库存操作，比如 Redis？\u003c/p\u003e\n\u003cp\u003e如果减库存逻辑非常单一的话，比如没有复杂的 SKU 库存和总库存这种联动关系的话，个人认为是完全可以的。但如果有比较复杂的减库存逻辑，或者需要使用到事务，那就必须在数据库中完成减库存操作。\u003c/p\u003e\n\u003cp\u003e4.2.2 优化DB性能\u003c/p\u003e\n\u003cp\u003e库存数据落地到数据库实现其实是一行存储（MySQL），因此会有大量线程来竞争 InnoDB 行锁。但并发越高，等待线程就会越多，TPS 下降，RT 上升，吞吐量会受到严重影响——注意，这里假设数据库已基于上文【性能优化】完成数据隔离，以便于讨论聚焦 。\u003c/p\u003e\n\u003cp\u003e解决并发锁的问题，有两种办法：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e应用层排队。通过缓存加入集群分布式锁，从而控制集群对数据库同一行记录进行操作的并发度，同时也能控制单个商品占用数据库连接的数量，防止热点商品占用过多的数据库连接\u003c/li\u003e\n\u003cli\u003e数据层排队。应用层排队是有损性能的，数据层排队是最为理想的。业界中，阿里的数据库团队开发了针对InnoDB 层上的补丁程序（patch），可以基于DB层对单行记录做并发排队，从而实现秒杀场景下的定制优化——注意，排队和锁竞争是有区别的，如果熟悉 MySQL 的话，就会知道 InnoDB 内部的死锁检测，以及 MySQL Server 和 InnoDB 的切换都是比较消耗性能的。另外阿里的数据库团队还做了很多其他方面的优化，如 COMMIT_ON_SUCCESS 和 ROLLBACK_ON_FAIL 的补丁程序，通过在 SQL 里加入提示（hint），实现事务不需要等待实时提交，而是在数据执行完最后一条 SQL 后，直接根据 TARGET_AFFECT_ROW 的结果进行提交或回滚，减少网络等待的时间（毫秒级）。目前阿里已将包含这些补丁程序的 MySQL 开源：\u003ca href=\"https://link.segmentfault.com/?enc=I%2FCSvHmwhqWWaIcvx%2BoGuw%3D%3D.9twostwyDIweyMcUrly3Zp6KPhQuFFX7eS%2FNY5bGVH3W2EN%2FLLcCmxl3cSe4rhiflb5yVJtZxmcjdRE5e2CqiLn7gsvN1ymwz5bAEmNgIr0%3D\"\u003eAliSQL\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cstrong\u003e4.3 小结\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e高读和高写的两种处理方式大相径庭。读请求的优化空间要大一些，而写请求的瓶颈一般都在存储层，优化思路的本质还是基于 CAP 理论做平衡。\u003c/p\u003e\n\u003ch4\u003e5 总结一下 \u003ca href=\"#item-0-15\" id=\"item-0-15\"\u003e\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e当然，减库存还有很多细节问题，例如预扣的库存超时后如何进行回补，再比如第三方支付如何保证减库存和付款时的状态一致性，这些也是很大的挑战。\u003c/p\u003e\n\u003ch3\u003e高可用 \u003ca href=\"#item-0-16\" id=\"item-0-16\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003e盯过秒杀流量监控的话，会发现它不是一条蜿蜒而起的曲线，而是一条挺拔的直线，这是因为秒杀请求高度集中于某一特定的时间点。这样一来就会造成一个特别高的零点峰值，而对资源的消耗也几乎是瞬时的。所以秒杀系统的可用性保护是不可或缺的。\u003c/p\u003e\n\u003ch4\u003e1 流量削峰 \u003ca href=\"#item-0-17\" id=\"item-0-17\"\u003e\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e对于秒杀的目标场景，最终能够抢到商品的人数是固定的，无论 100 人和 10000 人参加结果都是一样的，即有效请求额度是有限的。并发度越高，无效请求也就越多。但秒杀作为一种商业营销手段，活动开始之前是希望有更多的人来刷页面，只是真正开始后，秒杀请求不是越多越好。因此系统可以设计一些规则，人为的延缓秒杀请求，甚至可以过滤掉一些无效请求。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e1.1 答题\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e早期秒杀只是简单的点击秒杀按钮，后来才增加了答题。为什么要增加答题呢？主要是通过提升购买的复杂度，达到两个目的：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e防止作弊。早期秒杀器比较猖獗，存在恶意买家或竞争对手使用秒杀器扫货的情况，商家没有达到营销的目的，所以增加答题来进行限制\u003c/li\u003e\n\u003cli\u003e延缓请求。零点流量的起效时间是毫秒级的，答题可以人为拉长峰值下单的时长，由之前的 \u0026lt;1s 延长到 \u0026lt;10s。这个时间对于服务端非常重要，会大大减轻高峰期并发压力；另外，由于请求具有先后顺序，答题后置的请求到来时可能已经没有库存了，因此根本无法下单，此阶段落到数据层真正的写也就非常有限了\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e需要注意的是，答题除了做正确性验证，还需要对提交时间做验证，比如\u0026lt;1s 人为操作的可能性就很小，可以进一步防止机器答题的情况。\u003c/p\u003e\n\u003cp\u003e答题目前已经使用的非常普遍了，本质是通过在入口层削减流量，从而让系统更好地支撑瞬时峰值。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e1.2 排队\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e最为常见的削峰方案是使用消息队列，通过把同步的直接调用转换成异步的间接推送缓冲瞬时流量。除了消息队列，类似的排队方案还有很多，例如：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e线程池加锁等待\u003c/li\u003e\n\u003cli\u003e本地内存蓄洪等待\u003c/li\u003e\n\u003cli\u003e本地文件序列化写，再顺序读\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e排队方式的弊端也是显而易见的，主要有两点：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e请求积压。流量高峰如果长时间持续，达到了队列的水位上限，队列同样会被压垮，这样虽然保护了下游系统，但是和请求直接丢弃也没多大区别\u003c/li\u003e\n\u003cli\u003e用户体验。异步推送的实时性和有序性自然是比不上同步调用的，由此可能出现请求先发后至的情况，影响部分敏感用户的购物体验\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e排队本质是在业务层将一步操作转变成两步操作，从而起到缓冲的作用，但鉴于此种方式的弊端，最终还是要基于业务量级和秒杀场景做出妥协和平衡。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e1.3 过滤\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e过滤的核心结构在于分层，通过在不同层次过滤掉无效请求，达到数据读写的精准触发。常见的过滤主要有以下几层：\u003c/p\u003e\n\u003cp\u003e1、读限流：对读请求做限流保护，将超出系统承载能力的请求过滤掉 2、读缓存：对读请求做数据缓存，将重复的请求过滤掉 3、写限流：对写请求做限流保护，将超出系统承载能力的请求过滤掉 4、写校验：对写请求做一致性校验，只保留最终的有效数据\u003c/p\u003e\n\u003cp\u003e过滤的核心目的是通过减少无效请求的数据IO保障有效请求的IO性能。\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e1.4 小结\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e系统可以通过入口层的答题、业务层的排队、数据层的过滤达到流量削峰的目的，本质是在寻求商业诉求与架构性能之间的平衡。另外，新的削峰手段也层出不穷，以业务切入居多，比如零点大促时同步发放优惠券或发起抽奖活动，将一部分流量分散到其他系统，这样也能起到削峰的作用。\u003c/p\u003e\n\u003ch4\u003e2 Plan B \u003ca href=\"#item-0-18\" id=\"item-0-18\"\u003e\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e当一个系统面临持续的高峰流量时，其实是很难单靠自身调整来恢复状态的，日常运维没有人能够预估所有情况，意外总是无法避免。尤其在秒杀这一场景下，为了保证系统的高可用，必须设计一个 Plan B 方案来进行兜底。\u003c/p\u003e\n\u003cp\u003e高可用建设，其实是一个系统工程，贯穿在系统建设的整个生命周期。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/blog/tech/system/image_1_1.png\" alt=\"image_1_1.png\"\u003e\u003c/p\u003e\n\u003cp\u003e具体来说，系统的高可用建设涉及架构阶段、编码阶段、测试阶段、发布阶段、运行阶段，以及故障发生时，逐一进行分析：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e架构阶段：考虑系统的可扩展性和容错性，避免出现单点问题。例如多地单元化部署，即使某个IDC甚至地市出现故障，仍不会影响系统运转\u003c/li\u003e\n\u003cli\u003e编码阶段：保证代码的健壮性，例如RPC调用时，设置合理的超时退出机制，防止被其他系统拖垮，同时也要对无法预料的返回错误进行默认的处理\u003c/li\u003e\n\u003cli\u003e测试阶段：保证CI的覆盖度以及Sonar的容错率，对基础质量进行二次校验，并定期产出整体质量的趋势报告\u003c/li\u003e\n\u003cli\u003e发布阶段：系统部署最容易暴露错误，因此要有前置的checklist模版、中置的上下游周知机制以及后置的回滚机制\u003c/li\u003e\n\u003cli\u003e运行阶段：系统多数时间处于运行态，最重要的是运行时的实时监控，及时发现问题、准确报警并能提供详细数据，以便排查问题\u003c/li\u003e\n\u003cli\u003e故障发生：首要目标是及时止损，防止影响面扩大，然后定位原因、解决问题，最后恢复服务\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e对于日常运维而言，高可用更多是针对运行阶段而言的，此阶段需要额外进行加强建设，主要有以下几种手段：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e预防：建立常态压测体系，定期对服务进行单点压测以及全链路压测，摸排水位\u003c/li\u003e\n\u003cli\u003e管控：做好线上运行的降级、限流和熔断保护。需要注意的是，无论是限流、降级还是熔断，对业务都是有损的，所以在进行操作前，一定要和上下游业务确认好再进行。就拿限流来说，哪些业务可以限、什么情况下限、限流时间多长、什么情况下进行恢复，都要和业务方反复确认\u003c/li\u003e\n\u003cli\u003e监控：建立性能基线，记录性能的变化趋势；建立报警体系，发现问题及时预警\u003c/li\u003e\n\u003cli\u003e恢复：遇到故障能够及时止损，并提供快速的数据订正工具，不一定要好，但一定要有\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e在系统建设的整个生命周期中，每个环节中都可能犯错，甚至有些环节犯的错，后面是无法弥补的或者成本极高的。所以高可用是一个系统工程，必须放到整个生命周期中进行全面考虑。同时，考虑到服务的增长性，高可用更需要长期规划并进行体系化建设。\u003c/p\u003e\n\u003ch4\u003e3 总结一下 \u003ca href=\"#item-0-19\" id=\"item-0-19\"\u003e\u003c/a\u003e\u003c/h4\u003e\n\u003cp\u003e高可用其实是在说 “稳定性”，稳定性是一个平时不重要，但出了问题就要命的事情，然而它的落地又是一个问题——平时业务发展良好，稳定性建设就会降级给业务让路。解决这个问题必须在组织上有所保障，比如让业务负责人背上稳定性绩效指标，同时在部门中建立稳定性建设小组，小组成员由每条线的核心力量兼任，绩效由稳定性负责人来打分，这样就可以把体系化的建设任务落实到具体的业务系统中了。\u003c/p\u003e\n\u003ch3\u003e个人总结 \u003ca href=\"#item-0-20\" id=\"item-0-20\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003e一个秒杀系统的设计，可以根据不同级别的流量，由简单到复杂打造出不同的架构，本质是各方面的取舍和权衡。当然，你可能注意到，本文并没有涉及具体的选型方案，因为这些对于架构来说并不重要，作为架构师，应该时刻提醒自己主线是什么。\u003c/p\u003e\n\u003cp\u003e同时也在这里抽象、提炼一下，主要是个人对于秒杀设计的提纲式整理，方便各位同学进行参考——!\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/blog/tech/system/image_1_3.png\" alt=\"image_1_3.png\"\u003e\u003c/p\u003e\n"])</script><script>self.__next_f.push([1,"6:[\"$\",\"article\",null,{\"className\":\"min-h-screen\",\"children\":[\"$\",\"div\",null,{\"className\":\"mx-auto max-w-6xl px-4 sm:px-6 lg:px-8 py-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"rounded-2xl shadow-2xl border border-gray-200 hover:shadow-3xl transition-all duration-300 p-8 sm:p-12\",\"children\":[[\"$\",\"header\",null,{\"className\":\"mb-8\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex items-center mb-6\",\"children\":[\"$\",\"div\",null,{\"className\":\"inline-flex items-center px-3 py-1.5 bg-gray-50 text-gray-600 rounded-md text-sm font-normal\",\"children\":[[\"$\",\"svg\",null,{\"className\":\"w-4 h-4 mr-2 text-gray-400\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"viewBox\":\"0 0 24 24\",\"children\":[\"$\",\"path\",null,{\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"strokeWidth\":2,\"d\":\"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\"}]}],[\"$\",\"time\",null,{\"dateTime\":\"2024-03-10\",\"children\":\"2024年03月10日\"}]]}]}],[\"$\",\"h1\",null,{\"className\":\"text-4xl font-bold text-gray-900 mb-6 text-center\",\"children\":\"电商分析必懂的指标体系\"}],[\"$\",\"div\",null,{\"className\":\"flex flex-wrap gap-2 mb-6 justify-center\",\"children\":[[\"$\",\"$L5\",\"业务架构\",{\"href\":\"/blog/tag/%E4%B8%9A%E5%8A%A1%E6%9E%B6%E6%9E%84/page/1/\",\"className\":\"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-gray-200 text-gray-800 hover:bg-gray-300 hover:text-gray-900 transition-colors\",\"children\":\"业务架构\"}],[\"$\",\"$L5\",\"电商分析\",{\"href\":\"/blog/tag/%E7%94%B5%E5%95%86%E5%88%86%E6%9E%90/page/1/\",\"className\":\"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-gray-200 text-gray-800 hover:bg-gray-300 hover:text-gray-900 transition-colors\",\"children\":\"电商分析\"}]]}]]}],[\"$\",\"div\",null,{\"className\":\"max-w-5xl mx-auto\",\"children\":[\"$\",\"$L14\",null,{\"content\":\"$15\"}]}],[\"$\",\"$11\",null,{\"fallback\":[\"$\",\"div\",null,{\"className\":\"mt-12 pt-8 border-t border-gray-200\",\"children\":\"加载导航中...\"}],\"children\":[\"$\",\"$L16\",null,{\"globalNav\":{\"prev\":{\"slug\":\"tech/business/权限系统方案设计\",\"title\":\"权限系统方案设计\",\"description\":\"日常工作中权限的问题时时刻刻伴随着我们，程序员新入职一家公司需要找人开通各种权限，比如网络连接的权限、编码下载提交的权限、监控平台登录的权限、运营平台查数据的权限等等。在很多时候我们会觉得这么多繁杂的申请给工作带来不便，并且如果突然想要查一些数据，发现没有申请过权限，需要再走审批流程，时间拉得会很长。那为什么还需要这么严格的权限管理呢？\",\"pubDate\":\"2024-03-08\",\"tags\":[\"业务架构\",\"技术专题\"],\"heroImage\":\"$undefined\",\"content\":\"$17\"},\"next\":{\"slug\":\"tech/system/一个秒杀系统的设计思考\",\"title\":\"一个秒杀系统的设计思考\",\"description\":\"前言 秒杀大家都不陌生。自2011年首次出现以来，无论是双十一购物还是 12306抢票，秒杀场景已随处可见。简单来说，秒杀就是在同一时刻大量请求争抢购买同一商品并完成交易的过程。从架构视角来看，秒杀系统本质是一个高性能、高一致、高可用的三高系统。\",\"pubDate\":\"2024-03-14\",\"tags\":[\"架构设计\",\"技术专题\",\"秒杀系统\"],\"heroImage\":\"$undefined\",\"content\":\"$18\"}},\"tagNav\":{\"业务架构\":{\"prev\":\"$6:props:children:props:children:props:children:2:props:children:props:globalNav:prev\",\"next\":null},\"电商分析\":{\"prev\":null,\"next\":null}}}]}],[\"$\",\"$L19\",null,{}]]}]}]}]\n"])</script><script>self.__next_f.push([1,"9:null\n"])</script><script>self.__next_f.push([1,"d:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n8:null\n"])</script><script>self.__next_f.push([1,"b:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"电商分析必懂的指标体系 - Skyfalling Blog\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"今天，我就来讲讲电商到底该重点关注哪些指标，又该拿这些指标来进行怎么样的分析。 一般来说，在运营模块，需要重点关注的是新用户的引流和转化，以及老用户的活跃、留存、回购、流失。 简单来说，引流就是要吸引没买过我们的商品的人来买我们的商品。...\"}],[\"$\",\"meta\",\"2\",{\"property\":\"og:title\",\"content\":\"电商分析必懂的指标体系\"}],[\"$\",\"meta\",\"3\",{\"property\":\"og:description\",\"content\":\"今天，我就来讲讲电商到底该重点关注哪些指标，又该拿这些指标来进行怎么样的分析。 一般来说，在运营模块，需要重点关注的是新用户的引流和转化，以及老用户的活跃、留存、回购、流失。 简单来说，引流就是要吸引没买过我们的商品的人来买我们的商品。...\"}],[\"$\",\"meta\",\"4\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"5\",{\"property\":\"article:published_time\",\"content\":\"2024-03-10\"}],[\"$\",\"meta\",\"6\",{\"property\":\"article:author\",\"content\":\"Skyfalling\"}],[\"$\",\"meta\",\"7\",{\"name\":\"twitter:card\",\"content\":\"summary\"}],[\"$\",\"meta\",\"8\",{\"name\":\"twitter:title\",\"content\":\"电商分析必懂的指标体系\"}],[\"$\",\"meta\",\"9\",{\"name\":\"twitter:description\",\"content\":\"今天，我就来讲讲电商到底该重点关注哪些指标，又该拿这些指标来进行怎么样的分析。 一般来说，在运营模块，需要重点关注的是新用户的引流和转化，以及老用户的活跃、留存、回购、流失。 简单来说，引流就是要吸引没买过我们的商品的人来买我们的商品。...\"}],[\"$\",\"link\",\"10\",{\"rel\":\"shortcut icon\",\"href\":\"/favicon.png\"}],[\"$\",\"link\",\"11\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"16x16\"}],[\"$\",\"link\",\"12\",{\"rel\":\"icon\",\"href\":\"/favicon.png\"}],[\"$\",\"link\",\"13\",{\"rel\":\"apple-touch-icon\",\"href\":\"/favicon.png\"}]],\"error\":null,\"digest\":\"$undefined\"}\n"])</script><script>self.__next_f.push([1,"13:{\"metadata\":\"$b:metadata\",\"error\":null,\"digest\":\"$undefined\"}\n"])</script></body></html>